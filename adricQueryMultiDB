/*

Query from multiple DB on same server
----------------------------------------

A. Reference each piece with the 3 or 4 part name:

 

	Database.Schema.Table when referencing tables

		and

	Database.Schema.Table.Column when referencing columns
*/

select 
		[Database.Schema.Table]=DB.name + '.' 
		+ (select top 1 table_schema from Information_schema.tables) + '.SyVersionInfo'
		,[Database.Schema.Table.Column]=DB.name + '.' 
		+ (select top 1 table_schema from Information_schema.tables) + '.SyVersionInfo' + '.' + 'SyVersionInfoId'
		,[Built Query]='SELECT SY.VersionName,SY.* from ' + DB.name + '.' 
		+ (select top 1 table_schema from Information_schema.tables) + '.SyVersionInfo SY where SY.SyVersionInfoID in ' 
		+ '(select max(SY1.SyVersionInfoId) from ' + DB.name + '.' 
		+ (select top 1 table_schema from Information_schema.tables) + '.SyVersionInfo SY1'+ ') '
		+ 'Union'
		,*
		,LEN(DB.name)
		
from sys.databases DB
where name not in ('master','tempdb','model','msdb') 
and name not like '%portal%' 
and name not like '%report%' 
--Excluding really long auto-generated databases, IE: 
--PerformancePoint Service	Application_28e5ef2f8556415984a8d0210ce245a3
--These also seem to have [blanks] in them, which messes query up too
and LEN(DB.name) < 50



